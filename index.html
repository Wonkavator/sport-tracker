<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Training Tracker</title>

    <!-- PWA / Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#17A2B8">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="stylesheet" href="css/styles.css?v=23">

    <!-- Mobile Drag and Drop Polyfill -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-drag-drop@3.0.0-rc.0/default.css">
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@3.0.0-rc.0/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@3.0.0-rc.0/scroll-behaviour.min.js"></script>
    <script>
        // Options are optional
        MobileDragDrop.polyfill({
            // use this to make use of the scroll behaviour
            dragImageTranslateOverride: MobileDragDrop.scrollBehaviourDragImageTranslateOverride
        });
    </script>
</head>

<body>
    <header class="app-header">
        <div class="header-top" style="display: flex; justify-content: space-between; align-items: center;">
            <div style="width: 40px;"></div> <!-- Spacer for centering -->
            <h1>√úbungstracker</h1>
            <div style="display: flex; gap: 0.5rem; align-items: center;">
                <button id="theme-toggle" class="nav-btn"
                    style="background: none; border: none; font-size: 1.5rem; padding: 0.5rem; box-shadow: none; cursor: pointer;">üåô</button>
                <button id="nav-settings" class="app-nav-btn" data-target="settings"
                    style="background: none; border: none; font-size: 1.5rem; padding: 0.5rem; box-shadow: none; cursor: pointer; color: var(--text);">‚öôÔ∏è</button>
            </div>
        </div>
        <nav class="main-nav">
            <button id="nav-dashboard" class="app-nav-btn nav-btn active" data-target="dashboard">Woche</button>
            <button id="nav-train" class="app-nav-btn nav-btn" data-target="train">Trainieren</button>
            <button id="nav-progress" class="app-nav-btn nav-btn" data-target="progress">Erfolge</button>
            <button id="nav-analysis" class="app-nav-btn nav-btn" data-target="analysis">Auswertung</button>
        </nav>
    </header>

    <main class="app-content">
        <!-- View: Dashboard / Weekly Grid -->
        <section id="view-dashboard" class="view active">
            <div class="week-nav-header">
                <button id="btn-prev-week" class="week-nav-btn">&larr;</button>
                <h2 id="week-title">Aktuelle Woche</h2>
                <button id="btn-next-week" class="week-nav-btn">&rarr;</button>
            </div>
            <div id="weekly-grid-container">
                <!-- Grid will be generated by JS -->
            </div>
        </section>

        <!-- View: Training Selection -->
        <section id="view-train" class="view">
            <h2>√úbung ausw√§hlen</h2>
            <div id="category-list" class="list-container">
                <!-- Categories will be generated by JS -->
            </div>
        </section>

        <!-- View: Exercise Input Form -->
        <section id="view-input" class="view">
            <button id="btn-back-to-categories" class="back-btn">&larr; Zur√ºck</button>
            <h2 id="input-exercise-title">√úbung</h2>
            <form id="exercise-form">
                <div id="dynamic-inputs" class="input-container">
                    <!-- Inputs generated by JS based on exercise type -->
                </div>
                <button type="submit" class="submit-btn">Speichern</button>
            </form>
        </section>

        <!-- View: Success Animation / Feedback -->
        <section id="view-success" class="view">
            <div class="success-message">
                <span class="success-icon">‚≠ê</span>
                <h2>Super gemacht!</h2>
                <p>Dein Training wurde gespeichert.</p>
                <button id="btn-success-ok" class="nav-btn">Weiter</button>
            </div>
        </section>

        <!-- View: Long-term Progress -->
        <section id="view-progress" class="view">
            <h2>Gesamterfolge</h2>
            <div id="progress-container">
                <!-- Progress will be generated by JS -->
            </div>
        </section>

        <!-- View: Analysis / Auswertung -->
        <section id="view-analysis" class="view">
            <h2>Auswertung & Verlauf</h2>
            <div id="analysis-list-container">
                <!-- List of exercises with stats here -->
            </div>

            <div id="analysis-chart-container" style="display: none; margin-top: 1rem;">
                <button id="btn-close-chart" class="back-btn">&larr; Zur√ºck zur √úbersicht</button>
                <h3 id="chart-title" style="text-align: center; margin-bottom: 1rem;"></h3>

                <div class="chart-filters"
                    style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 1rem;">
                    <button class="filter-btn active" data-filter="day-7">7 Tage</button>
                    <button class="filter-btn" data-filter="day-30">30 Tage</button>
                    <button class="filter-btn" data-filter="day">Alle</button>
                    <button class="filter-btn" data-filter="week">Wochen</button>
                    <button class="filter-btn" data-filter="month">Monate</button>
                </div>

                <div style="position: relative; height: 50vh; width: 100%;">
                    <canvas id="exerciseChart"></canvas>
                </div>
            </div>
        </section>

        <!-- View: Settings (Einstellungen) / Custom Exercise Builder -->
        <section id="view-settings" class="view">
            <h2>Einstellungen (√úbungen verwalten)</h2>

            <div class="settings-card">
                <h3 id="form-title">Neue √úbung erstellen</h3>
                <form id="create-exercise-form">
                    <div class="input-group">
                        <label for="new-ex-name">Name der √úbung</label>
                        <input type="text" id="new-ex-name" required placeholder="z.B. Yoga, Hanteltraining...">
                    </div>

                    <div class="input-group">
                        <label for="new-ex-cat">Kategorie (Farbe)</label>
                        <select id="new-ex-cat" required>
                            <option value="cat-yellow">Ausdauer & Beine (Gelb)</option>
                            <option value="cat-orange">Kraft & Motorik (Orange)</option>
                            <option value="cat-red">Atmung (Rot)</option>
                            <option value="cat-green">Rumpf & Rollstuhl (Gr√ºn)</option>
                            <option value="cat-blue">Geist & Stimme (Blau)</option>
                        </select>
                    </div>

                    <p style="margin-top: 1.5rem; margin-bottom: 0.5rem; font-weight: bold;">Ben√∂tigte Eingabefelder
                        (Ziehen & Ablegen oder Antippen)</p>
                    <div class="dnd-container" style="display: flex; gap: 1rem;">
                        <div class="dnd-column">
                            <h4>Verf√ºgbar</h4>
                            <div id="dnd-available" class="dnd-zone">
                                <!-- Filled by JS -->
                            </div>
                        </div>
                        <div class="dnd-column">
                            <h4>Ausgew√§hlt (Hier ablegen)</h4>
                            <div id="dnd-selected" class="dnd-zone">
                                <p class="placeholder-text">Ziehe Felder hierher</p>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn" style="margin-top: 1.5rem;">√úbung speichern</button>
                </form>
            </div>

            <div class="settings-card" style="margin-top: 2rem;">
                <h3>Meine √úbungen verwalten</h3>
                <div id="custom-exercises-list">
                    <!-- Filled by JS -->
                </div>

                <h4 style="margin-top: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;">
                    Archivierte √úbungen</h4>
                <div id="archived-exercises-list" style="margin-top: 1rem;">
                    <!-- Filled by JS -->
                </div>
            </div>

            <div class="settings-card" style="margin-top: 2rem;">
                <h3>Daten-Backups</h3>
                <p style="margin-bottom: 1rem; color: var(--text-mut);">Sichere deine Trainingsdaten oder stelle sie auf
                    einem anderen Ger√§t wieder her.</p>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button type="button" id="btn-export-data" class="submit-btn"
                        style="flex: 1; background-color: var(--cat-blue); margin: 0;">‚¨áÔ∏è Daten exportieren</button>

                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                    <button type="button" id="btn-import-data"
                        style="flex: 1; border: 2px solid var(--cat-orange); color: var(--cat-orange); background: none; border-radius: 8px; font-weight: bold; font-size: 1rem; padding: 1rem; cursor: pointer;">‚¨ÜÔ∏è
                        Daten importieren</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Custom Delete Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <h3>Eintrag l√∂schen?</h3>
            <p id="delete-modal-text">M√∂chtest du dieses Training wirklich l√∂schen?</p>
            <div class="modal-actions">
                <button id="btn-cancel-delete" class="nav-btn">Abbrechen</button>
                <button id="btn-confirm-delete" class="submit-btn"
                    style="background-color: var(--cat-red); margin-top: 0;">L√∂schen</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="delete-modal-title">√úbung l√∂schen?</h3>
            <p id="delete-custom-modal-text">M√∂chtest du diese √úbung wirklich aus der Liste entfernen?</p>
            <div class="modal-actions">
                <button type="button" id="delete-modal-cancel" class="nav-btn">Abbrechen</button>
                <button type="button" id="delete-modal-confirm" class="submit-btn"
                    style="background-color: var(--cat-red);">L√∂schen</button>
            </div>
        </div>
    </div>

    <!-- Hard Delete Modal -->
    <div id="hard-delete-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Endg√ºltig l√∂schen?</h3>
            <p id="hard-delete-modal-text">M√∂chtest du diese √úbung und JEDEN zugeh√∂rigen Verlaufseintrag unwiderruflich
                l√∂schen?</p>
            <div class="modal-actions">
                <button type="button" id="hard-delete-modal-cancel" class="nav-btn">Abbrechen</button>
                <button type="button" id="hard-delete-modal-confirm" class="submit-btn"
                    style="background-color: var(--cat-red);">Endg√ºltig l√∂schen</button>
            </div>
        </div>
    </div>

    <!-- Chart.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/data.js?v=23"></script>
    <script src="js/storage.js?v=23"></script>
    <script src="js/app.js?v=23"></script>

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.error('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>

</html>